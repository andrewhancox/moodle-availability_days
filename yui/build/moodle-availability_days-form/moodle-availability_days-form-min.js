YUI.add("moodle-availability_days-form",function(e,t){M.availability_days=M.availability_days||{},M.availability_days.form=e.Object(M.core_availability.plugin),M.availability_days.form.days=null,M.availability_days.form.initInner=function(e){this.datepickerhtml=e},M.availability_days.form.getNode=function(t){var n=M.str.availability_days;t.d===undefined&&(t.d="");var r='<div class="availability-group"><label>';r+=' <input type="text" size="4" name="field" class="availability_days_settings" value="'+t.d+'">',r+="&nbsp;",r+='<select name="units" class="custom-select availability_days_settings"><option value="years">'+M.util.get_string("years","availability_days")+"</option>"+'<option value="months">'+M.util.get_string("months","availability_days")+"</option>"+'<option value="weeks">'+M.util.get_string("weeks","availability_days")+"</option>"+'<option value="days">'+M.util.get_string("days","availability_days")+"</option>"+'<option value="minutes">'+M.util.get_string("minutes","availability_days")+"</option>"+'<option value="seconds">'+M.util.get_string("seconds","availability_days")+"</option>"+"</select>",r+="&nbsp;",r+=n.conditiontitle,r+="</label></div>",r+='<div class="availability-group"><label>'+M.util.get_string("applyrestrictionforuserafter","availability_days")+"</label></div>",r+='<div class="availability-group"><label>'+this.datepickerhtml+'<input type="checkbox" class="availability_days_settings" name="enableenrolledafter" id="enableenrolledafter"/>'+M.util.get_string("enableenrolledafter","availability_days")+"</label></div>";var i=e.Node.create("<span>"+r+"</span>");i.one("input[name=field]").set("value",t.d);var s=!1;t.eea!==undefined&&(s=t.eea),i.one("input[name=enableenrolledafter]").set("checked",s),i.all("span.datefields select").set("disabled",!s);var o="days";t.units!==undefined&&(o=t.units),i.one("select[name=units]").set("value",o);if(t.t!==undefined){i.setData("time",t.t),i.all("span.datefields)").each(function(e){e.set("disabled",!0)});var u=M.cfg.wwwroot+"/availability/condition/days/ajax.php?action=fromtime"+"&time="+t.t;e.io(u,{on:{success:function(t,n){var r=e.JSON.parse(n.responseText);for(var s in r){var o=i.one("select[name=x\\["+s+"\\]]");o.set("value",""+r[s])}},failure:function(){window.alert(M.util.get_string("ajaxerror","availability_days"))}}})}else i.setData("time",this.defaultTime);if(!M.availability_days.form.addedEvents){M.availability_days.form.addedEvents=!0;var a=function(e){var t=e.ancestor("span.availability_days");M.core_availability.form.update()},f=e.one(".availability-field");f.delegate("change",function(){a(this)},".availability_days_settings"),f.delegate("change",function(){M.availability_days.form.updateTime(this.ancestor("span.availability_days"))},".availability_days span.datefields"),f.delegate("change",function(){e.all("span.datefields select").set("disabled",!e.one(".availability_days #enableenrolledafter").get("checked"))},".availability_days #enableenrolledafter")}if(i.one("a[href=#]")){M.form.dateselector.init_single_date_selector(i);var l=i.one("select[name=x\\[year\\]]"),c=l.set;l.set=function(e,t){c.call(l,e,t),e==="selectedIndex"&&setTimeout(function(){M.availability_days.form.updateTime(i)},0)}}return i},M.availability_days.form.updateTime=function(t){var n=M.cfg.wwwroot+"/availability/condition/days/ajax.php?action=totime"+"&year="+t.one("select[name=x\\[year\\]]").get("value")+"&month="+t.one("select[name=x\\[month\\]]").get("value")+"&day="+t.one("select[name=x\\[day\\]]").get("value")+"&hour="+t.one("select[name=x\\[hour\\]]").get("value")+"&minute="+t.one("select[name=x\\[minute\\]]").get("value");e.io(n,{on:{success:function(e,n){t.setData("time",n.responseText),M.core_availability.form.update()},failure:function(){window.alert(M.util.get_string("ajaxerror","availability_date"))}}})},M.availability_days.form.fillValue=function(e,t){e.d=t.one("input[name=field]").get("value"),e.units=t.one("select[name=units]").get("value"),e.t=parseInt(t.getData("time"),10),e.eea=t.one("input[name=enableenrolledafter]").get("checked")}},"@VERSION@",{requires:["base","node","event","io","moodle-core_availability-form"]});
